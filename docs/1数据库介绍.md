### 第一章 SQL 介绍

**1. 什么是 SQL**

SQL 是用于访问和处理数据库的标准的计算机语言

-   SQL 指结构化查询语言
-   SQL 使我们有能力访问数据库
-   SQL 是一种 ANSI 的标准计算机语言

![](https://img-blog.csdnimg.cn/img_convert/f18044960d11c244060df7e4f5f64162.png)

SQL 可与数据库程序协同工作，比如 MS Access、DB2、Informix、MS SQL Server、Oracle、Sybase 以及其他数据库系统

但是由于各种各样的数据库出现，导致很多不同版本的 SQL 语言。

为了与 ANSI 标准相兼容，它们必须以相似的方式共同地来支持一些主要的关键词（比如 SELECT、UPDATE、DELETE、INSERT、WHERE 等等），这些就是我们要学习的SQL基础。

**2. SQL 的类型**

可以把 SQL 分为两个部分：数据操作语言 (DML) 和 数据定义语言 (DDL)。

-   数据查询语言（DQL: Data Query Language）
-   数据操纵语言（DML：Data Manipulation Language）

**3. 学习 SQL 的作用**

SQL 是一门 ANSI 的标准计算机语言，用来访问和操作数据库系统。SQL 语句用于取回和更新数据库中的数据。

-   SQL 面向数据库执行查询
-   SQL 可从数据库取回数据
-   SQL 可在数据库中插入新的记录
-   SQL 可更新数据库中的数据
-   SQL 可从数据库删除记录
-   SQL 可创建新数据库
-   SQL 可在数据库中创建新表
-   SQL 可在数据库中创建存储过程
-   SQL 可在数据库中创建视图
-   SQL 可以设置表、存储过程和视图的权限

**4. 数据库是什么**

**顾名思义，你可以理解为数据库是用来存放数据的一个容器。**

打个比方，每个人家里都会有冰箱，冰箱是用来干什么的？冰箱是用来存放食物的地方。

![](https://img-blog.csdnimg.cn/img_convert/297948d2d7708ab2a5f51be170d95478.png)

同样的，数据库是存放数据的地方。正是因为有了数据库后，我们可以直接查找数据。

例如你每天使用余额宝查看自己的账户收益，就是从数据库读取数据后给你的。

**最常见的数据库类型是关系型数据库管理系统（RDBMS）：**

RDBMS 是 SQL 的基础，同样也是所有现代数据库系统的基础，比如：

-   MS SQL Server
-   IBM DB2
-   Oracle
-   MySQL
-   Microsoft Access

![](https://img-blog.csdnimg.cn/img_convert/a3a8d706adba1e3a19877ebda6c1f1cb.png)

**RDBMS** 中的数据存储在被称为表（tables）的数据库对象中。**表** 是相关的数据项的集合，它由列和行组成。

**咱们直接开始学习SQL！**

**02 SQL 基础语言学习**

在了解 SQL 基础语句使用之前，我们先讲一下 **表** 是什么？

一个数据库通常包含一个或多个表。每个表由一个名字标识（例如“客户”或者“订单”）。表包含带有数据的记录(行)。

**下面的例子是一个名为 “Persons” 的表：**

| **Id** | **LastName** | **FirstName** | **Address** | **City** |
| --- | --- | --- | --- | --- |
| 1 | Adams | John | Oxford Street | London |
| 2 | Bush | George | Fifth Avenue | New York |
| 3 | Carter | Thomas | Changan Street | Beijing |

上面的表包含三条记录（每一条对应一个人）和五个列（Id、姓、名、地址和城市）。

**有表才能查询，那么如何创建这样一个表？**

**1. CREATE TABLE – 创建表**

CREATE TABLE 语句用于创建数据库中的表。

**语法：**

```sql
CREATE TABLE 表名称 ( 列名称1 数据类型, 列名称2 数据类型, 列名称3 数据类型, .... );
```

数据类型（data\_type）规定了列可容纳何种数据类型。下面的表格包含了SQL中最常用的数据类型：

| **数据类型** | **描述** |
| --- | --- |
| integer(size),int(size),smallint(size),tinyint(size) | 仅容纳整数、在括号内规定数字的最大位数 |
| decimal(size,d),numeric(size,d) | 容纳带有小数的数字、“size” 规定数字的最大位数、“d” 规定小数点右侧的最大位数 |
| char(size) | 容纳固定长度的字符串（可容纳字母、数字以及特殊字符）、在括号中规定字符串的长度 |
| varchar(size) | 容纳可变长度的字符串（可容纳字母、数字以及特殊的字符）、在括号中规定字符串的最大长度 |
| date(yyyymmdd) | 容纳日期 |

**实例：**

本例演示如何创建名为 “Persons” 的表。

该表包含 5 个列，列名分别是：“Id\_P”、“LastName”、“FirstName”、“Address” 以及 “City”：

```sql
CREATE TABLE Persons ( Id_P int, LastName varchar(255), FirstName varchar(255), Address varchar(255), City varchar(255) );
```

Id\_P 列的数据类型是 int，包含整数。其余 4 列的数据类型是 varchar，最大长度为 255 个字符。

![](https://img-blog.csdnimg.cn/img_convert/3a9a068cdad4aad1772f680f9b0540ab.png)

![](https://img-blog.csdnimg.cn/img_convert/cc724860fe7f8f71b3d7a66f6c959447.png)

**空的 “Persons” 表类似这样：**

![](https://img-blog.csdnimg.cn/img_convert/b24f177fe80318f027e93c2ec8108a9a.png)

可使用 INSERT INTO 语句向空表写入数据。

**2\. INSERT – 插入数据**

INSERT INTO 语句用于向表格中插入新的行。

**语法：**

```sql
INSERT INTO 表名称 VALUES (值1, 值2,....); 我们也可以指定所要插入数据的列： INSERT INTO table_name (列1, 列2,...) VALUES (值1, 值2,....);
```

**实例：**

本例演示 “Persons” 表插入记录的两种方式：

**1）插入新的行**

```sql
INSERT INTO Persons VALUES (1, 'Gates', 'Bill', 'Xuanwumen 10', 'Beijing');
```

**2）在指定的列中插入数据**

```sql
INSERT INTO Persons (LastName, Address) VALUES ('Wilson', 'Champs-Elysees');
```

![](https://img-blog.csdnimg.cn/img_convert/803bff7d388e3ada3e21ca10b76dd48e.png)

**插入成功后，数据如下：**

![](https://img-blog.csdnimg.cn/img_convert/c70c35678f4b4c7129746721bc53110d.png)

这个数据插入之后，是通过 SELECT 语句进行查询出来的，别急马上讲！

### **3. SELECT – 查询数据**

SELECT 语句用于从表中选取数据，结果被存储在一个结果表中（称为结果集）。

**语法：**

```sql
SELECT * FROM 表名称;
```

我们也可以指定所要查询数据的列：

```sql
SELECT 列名称 FROM 表名称;
```

**注意：**

SQL 语句对大小写不敏感，SELECT 等效于 select。

**实例：**

**SQL SELECT \* 实例：**

```sql
SELECT * FROM Persons;
```

![](https://img-blog.csdnimg.cn/img_convert/a3e9d10889006f0f2e568c6e67617482.png)

**注意：**

星号（\*）是选取所有列的快捷方式。

如需获取名为 “LastName” 和 “FirstName” 的列的内容（从名为 “Persons” 的数据库表），请使用类似这样的 SELECT 语句：

```sql
SELECT LastName,FirstName FROM Persons;
```

![](https://img-blog.csdnimg.cn/img_convert/5d90d9ce257cd8421dfdd138ab68f209.png)

### **4. DISTINCT – 去除重复值**

如果一张表中有多行重复数据，如何去重显示呢？可以了解下 **DISTINCT** 。

**语法：**

```sql
SELECT DISTINCT 列名称 FROM 表名称;
```

**实例：**

如果要从 “LASTNAME” 列中选取所有的值，我们需要使用 **SELECT** 语句：

```sql
SELECT LASTNAME FROM Persons;
```

![](https://img-blog.csdnimg.cn/img_convert/0d82fb482ae89e28868143eb10f50b6a.png)

可以发现，在结果集中，Wilson 被列出了多次。

如需从 “LASTNAME” 列中仅选取唯一不同的值，我们需要使用 SELECT DISTINCT 语句：

```sql
SELECT DISTINCT LASTNAME FROM Persons;
```

![](https://img-blog.csdnimg.cn/img_convert/ad6cd3b428c221e580121d6e80d7077d.png)

通过上述查询，结果集中只显示了一列 Wilson，显然已经去除了重复列。

### **5. WHERE – 条件过滤**

如果需要从表中选取指定的数据，可将 WHERE 子句添加到 SELECT 语句。

**语法：**

```sql
SELECT 列名称 FROM 表名称 WHERE 列 运算符 值;
```

下面的运算符可在 WHERE 子句中使用：

| **操作符** | **描述** |
| --- | --- |
| \= | 等于 |
| <> | 不等于 |
| \> | 大于 |
| < | 小于 |
| \>= | 大于等于 |
| <= | 小于等于 |
| BETWEEN | 在某个范围内 |
| LIKE | 搜索某种模式 |

**注意：**

在某些版本的 SQL 中，操作符 <> 可以写为 !=。

**实例：**

如果只希望选取居住在城市 “Beijing” 中的人，我们需要向 SELECT 语句添加 WHERE 子句：

```sql
SELECT * FROM Persons WHERE City='Beijing';
```

![](https://img-blog.csdnimg.cn/img_convert/622e25a45cd013557b04201ebdc2b50a.png)

**注意：**

SQL 使用单引号来环绕文本值（大部分数据库系统也接受双引号）。如果是数值，请不要使用引号。

### **6. AND & OR – 运算符**

AND 和 OR 可在 WHERE 子语句中把两个或多个条件结合起来。

-   如果第一个条件和第二个条件都成立，则 AND 运算符显示一条记录。
    
-   如果第一个条件和第二个条件中只要有一个成立，则 OR 运算符显示一条记录。
    

**语法：**

**AND 运算符实例：**

```sql
SELECT * FROM 表名称 WHERE 列 运算符 值 AND 列 运算符 值;
```

**OR 运算符实例：**

```sql
SELECT * FROM 表名称 WHERE 列 运算符 值 OR 列 运算符 值;
```

**实例：**

由于 Persons 表数据太少，因此增加几条记录：

```sql
INSERT INTO Persons VALUES (2, 'Adams', 'John', 'Oxford Street', 'London'); INSERT INTO Persons VALUES (3, 'Bush', 'George', 'Fifth Avenue', 'New York'); INSERT INTO Persons VALUES (4, 'Carter', 'Thomas', 'Changan Street', 'Beijing'); INSERT INTO Persons VALUES (5, 'Carter', 'William', 'Xuanwumen 10', 'Beijing'); SELECT * FROM Persons;
```

![](https://img-blog.csdnimg.cn/img_convert/ed7cff9b25b97a8471949ec126ef9c79.png)

**AND 运算符实例：**

使用 AND 来显示所有姓为 “Carter” 并且名为 “Thomas” 的人：

```sql
SELECT * FROM Persons WHERE FirstName='Thomas' AND LastName='Carter';
```

![](https://img-blog.csdnimg.cn/img_convert/0826459d2e04d544fca93e4f7e201621.png)

**OR 运算符实例：**

使用 OR 来显示所有姓为 “Carter” 或者名为 “Thomas” 的人：

```sql
SELECT * FROM Persons WHERE firstname='Thomas' OR lastname='Carter';
```

![](https://img-blog.csdnimg.cn/img_convert/53cf1f5c75251fb1109529d7ba496882.png)

**结合 AND 和 OR 运算符：**

我们也可以把 AND 和 OR 结合起来（使用圆括号来组成复杂的表达式）:

```sql
SELECT * FROM Persons WHERE (FirstName='Thomas' OR FirstName='William') AND LastName='Carter';
```

![](https://img-blog.csdnimg.cn/img_convert/95684417cdda24b531bcffb854cdaff5.png)

### **7. ORDER BY – 排序**

ORDER BY 语句用于根据指定的列对结果集进行排序，默认按照升序对记录进行排序，如果您希望按照降序对记录进行排序，可以使用 DESC 关键字。

**语法：**

```sql
SELECT * FROM 表名称 ORDER BY 列1,列2 DESC;
```

默认排序为 ASC 升序，DESC 代表降序。

**实例：**

以字母顺序显示 **LASTNAME** 名称：

```sql
SELECT * FROM Persons ORDER BY LASTNAME;
```

![](https://img-blog.csdnimg.cn/img_convert/02f0ad1f3711f41818ba6c3aab400e54.png)

空值（NULL）默认排序在有值行之后。

以数字顺序显示**ID\_P**，并以字母顺序显示 **LASTNAME** 名称：

```sql
SELECT * FROM Persons ORDER BY ID_P,LASTNAME;
```

![](https://img-blog.csdnimg.cn/img_convert/c78f3594551b200055f9f40648ed01aa.png)

以数字降序显示**ID\_P**：

```sql
SELECT * FROM Persons ORDER BY ID_P DESC;
```

![](https://img-blog.csdnimg.cn/img_convert/f3aa9ae6a7825757b8dc935b964df45b.png)

**注意：**

在第一列中有相同的值时，第二列是以升序排列的。如果第一列中有些值为 null 时，情况也是这样的。

### **8\. UPDATE – 更新数据**

Update 语句用于修改表中的数据。

**语法：**

```sql
UPDATE 表名称 SET 列名称 = 新值 WHERE 列名称 = 某值;
```

**实例：**

**更新某一行中的一个列：**

目前 **Persons** 表有很多字段为 **null** 的数据，可以通过 **UPDATE** 为 LASTNAME 是 “Wilson” 的人添加FIRSTNAME：

```sql
UPDATE Persons SET FirstName = 'Fred' WHERE LastName = 'Wilson';
```

![](https://img-blog.csdnimg.cn/img_convert/f5883093e3d2afdaa562bd57a6113ced.png)

**更新某一行中的若干列：**

```sql
UPDATE Persons SET ID_P = 6,city= 'London' WHERE LastName = 'Wilson';
```

![](https://img-blog.csdnimg.cn/img_convert/7c8e608a9e7362f1a154f587d52cd11b.png)

### **9. DELETE – 删除数据**

DELETE 语句用于删除表中的行。

**语法：**

```sql
DELETE FROM 表名称 WHERE 列名称 = 值;
```

**实例：**

**删除某行：**

删除 **Persons** 表中 LastName 为 “Fred Wilson” 的行：

```sql
DELETE FROM Persons WHERE LastName = 'Wilson';
```

![](https://img-blog.csdnimg.cn/img_convert/85c26e9d70f237597f158adf40fb15ad.png)

**删除所有行：**

可以在不删除表的情况下删除所有的行。这意味着表的结构、属性和索引都是完整的：

```sql
DELETE FROM table_name;
```

![](https://img-blog.csdnimg.cn/img_convert/a35876bb36bab1f0b057fe4fa9aba6ee.png)

### **10. TRUNCATE TABLE – 清除表数据**

如果我们仅仅需要除去表内的数据，但并不删除表本身，那么我们该如何做呢？

可以使用 TRUNCATE TABLE 命令（仅仅删除表格中的数据）：

**语法：**

```sql
TRUNCATE TABLE 表名称;
```

**实例：**

本例演示如何删除名为 “Persons” 的表。

```sql
TRUNCATE TABLE persons;
```

### **11. DROP TABLE – 删除表**

DROP TABLE 语句用于删除表（表的结构、属性以及索引也会被删除）。

**语法：**

```sql
DROP TABLE 表名称;
```

**实例：**

本例演示如何删除名为 “Persons” 的表。

```sql
drop table persons;
```

![](https://img-blog.csdnimg.cn/img_convert/5a0a75c7394c2b24bbab746a8ccc8820.png)

从上图可以看出，第一次执行删除时，成功删除了表 **persons**，第二次执行删除时，报错找不到表 **persons**，说明表已经被删除了。

## **03 SQL 高级言语学习**

### **1. LIKE – 查找类似值**

LIKE 操作符用于在 WHERE 子句中搜索列中的指定模式。

**语法：**

```sql
SELECT 列名/(*) FROM 表名称 WHERE 列名称 LIKE 值;
```

**实例：**

**Persons** 表插入数据：

```sql
INSERT INTO Persons VALUES (1, 'Gates', 'Bill', 'Xuanwumen 10', 'Beijing'); INSERT INTO Persons VALUES (2, 'Adams', 'John', 'Oxford Street', 'London'); INSERT INTO Persons VALUES (3, 'Bush', 'George', 'Fifth Avenue', 'New York'); INSERT INTO Persons VALUES (4, 'Carter', 'Thomas', 'Changan Street', 'Beijing'); INSERT INTO Persons VALUES (5, 'Carter', 'William', 'Xuanwumen 10', 'Beijing'); select * from persons;
```

![](https://img-blog.csdnimg.cn/img_convert/268a921c0bef87bbfc7594cc79a0b850.png)

1）现在，我们希望从上面的 “Persons” 表中选取居住在以 “N” 开头的城市里的人：

```sql
SELECT * FROM Persons WHERE City LIKE 'N%';
```

![](https://img-blog.csdnimg.cn/img_convert/2c0bcc1e2b592bf9dac9462392e48ff7.png)

2）接下来，我们希望从 “Persons” 表中选取居住在以 “g” 结尾的城市里的人：

```sql
SELECT * FROM Persons WHERE City LIKE '%g';
```

![](https://img-blog.csdnimg.cn/img_convert/bc9ef9e22d14234af8583e1c0634f899.png)

3）接下来，我们希望从 “Persons” 表中选取居住在包含 “lon” 的城市里的人：

```sql
SELECT * FROM Persons WHERE City LIKE '%on%';
```

![](https://img-blog.csdnimg.cn/img_convert/93bc20a83187515ccd3ce70cb80eb021.png)

4）通过使用 NOT 关键字，我们可以从 “Persons” 表中选取居住在不包含 “lon” 的城市里的人：

```sql
SELECT * FROM Persons WHERE City NOT LIKE '%on%';
```

![](https://img-blog.csdnimg.cn/img_convert/4f35f32f4b8206b53d081c718016f4ea.png)

**注意：**

“%” 可用于定义通配符（模式中缺少的字母）。

### **2. IN – 锁定多个值**

IN 操作符允许我们在 WHERE 子句中规定多个值。

**语法：**

```sql
SELECT 列名/(*) FROM 表名称 WHERE 列名称 IN (值1,值2,值3);
```

**实例：**

现在，我们希望从 **Persons** 表中选取姓氏为 Adams 和 Carter 的人：

```sql
SELECT * FROM Persons WHERE LastName IN ('Adams','Carter');
```

![](https://img-blog.csdnimg.cn/img_convert/a0fd79735186214902150d53f96660ba.png)

### **3. BETWEEN – 选取区间数据**

操作符 BETWEEN … AND 会选取介于两个值之间的数据范围。这些值可以是数值、文本或者日期。

**语法：**

```sql
SELECT 列名/(*) FROM 表名称 WHERE 列名称 BETWEEN 值1 AND 值2;
```

**实例：**

1）查询以字母顺序显示介于 “Adams”（包括）和 “Carter”（不包括）之间的人：

```sql
SELECT * FROM Persons WHERE LastName BETWEEN 'Adams' AND 'Carter';
```

![](https://img-blog.csdnimg.cn/img_convert/5aa64a3397f7f42bc2b2abfaf1247155.png)

2）查询上述结果相反的结果，可以使用 NOT：

```sql
SELECT * FROM Persons WHERE LastName NOT BETWEEN 'Adams' AND 'Carter';
```

![](https://img-blog.csdnimg.cn/img_convert/e8d62ca59ed78100b86eae7771a95ab9.png)

**注** **意：**

不同的数据库对 BETWEEN…AND 操作符的处理方式是有差异的。

> 某些数据库会列出介于 “Adams” 和 “Carter” 之间的人，但不包括 “Adams” 和 “Carter” ；某些数据库会列出介于 “Adams” 和 “Carter” 之间并包括 “Adams” 和 “Carter” 的人；而另一些数据库会列出介于 “Adams” 和 “Carter” 之间的人，包括 “Adams” ，但不包括 “Carter” 。

**所以，请检查你的数据库是如何处理 BETWEEN…AND 操作符的！**

### **4. AS – 别名**

通过使用 SQL，可以为列名称和表名称指定别名（Alias），别名使查询程序更易阅读和书写。

**语法：**

**表别名：**

```sql
SELECT 列名称/(*) FROM 表名称 AS 别名;
```

**列别名：**

```sql
SELECT 列名称 as 别名 FROM 表名称;
```

**实例：**

**使用表名称别名：**

```sql
SELECT p.LastName, p.FirstName FROM Persons p WHERE p.LastName='Adams' AND p.FirstName='John';
```

![](https://img-blog.csdnimg.cn/img_convert/dc975a08340342270f36f13486655c5b.png)

**使用列名别名：**

```sql
SELECT LastName "Family", FirstName "Name" FROM Persons;
```

![](https://img-blog.csdnimg.cn/img_convert/d3206dd702473ae4dc5be066480d77fb.png)

**注意：**

实际应用时，这个 **AS** 可以省略，但是列别名需要加上 **" "**。

### **5. JOIN – 多表关联**

**JOIN** 用于根据两个或多个表中的列之间的关系，从这些表中查询数据。

有时为了得到完整的结果，我们需要从两个或更多的表中获取结果。我们就需要执行 **join**。

数据库中的表可通过键将彼此联系起来。主键（Primary Key）是一个列，在这个列中的每一行的值都是唯一的。在表中，每个主键的值都是唯一的。这样做的目的是在不重复每个表中的所有数据的情况下，把表间的数据交叉捆绑在一起。

![](https://img-blog.csdnimg.cn/img_convert/ab38917d1460e7611b5ebe5d8ae6c6ea.png)

如图，“Id\_P” 列是 Persons 表中的的主键。这意味着没有两行能够拥有相同的 Id\_P。即使两个人的姓名完全相同，Id\_P 也可以区分他们。

**为了下面实验的继续，我们需要再创建一个表：Orders。**

```sql
create table orders (id_o number,orderno number,id_p number); insert into orders values(1,11111,1); insert into orders values(2,22222,2); insert into orders values(3,33333,3); insert into orders values(4,44444,4); insert into orders values(6,66666,6); select * from orders;
```

![](https://img-blog.csdnimg.cn/img_convert/cd327d626cb81429c379c02036dcb058.png)

如图，“Id\_O” 列是 Orders 表中的的主键，同时，“Orders” 表中的 “Id\_P” 列用于引用 “Persons” 表中的人，而无需使用他们的确切姓名。

```sql
select * from persons p,orders o where p.id_p=o.id_p;
```

![](https://img-blog.csdnimg.cn/img_convert/a93c8089f757ac2c6bf7c89245d25c14.png)

可以看到，“Id\_P” 列把上面的两个表联系了起来。

**语法：**

```sql
select 列名 from 表A INNER|LEFT|RIGHT|FULL JOIN 表B ON 表A主键列 = 表B外键列;
```

**不同的 SQL JOIN：**

下面列出了您可以使用的 JOIN 类型，以及它们之间的差异。

-   JOIN: 如果表中有至少一个匹配，则返回行
-   INNER JOIN: 内部连接，返回两表中匹配的行
-   LEFT JOIN: 即使右表中没有匹配，也从左表返回所有的行
-   RIGHT JOIN: 即使左表中没有匹配，也从右表返回所有的行
-   FULL JOIN: 只要其中一个表中存在匹配，就返回行

**实例：**

如果我们希望列出所有人的定购，可以使用下面的 SELECT 语句：

```sql
SELECT p.LastName, p.FirstName, o.OrderNo FROM Persons p INNER JOIN Orders o ON p.Id_P = o.Id_P ORDER BY p.LastName DESC;
```

![](https://img-blog.csdnimg.cn/img_convert/2e3c9fc1c3fb100209c3accc11f233c4.png)

### **6. UNION – 合并结果集**

UNION 操作符用于合并两个或多个 SELECT 语句的结果集。

**UNION 语法：**

```sql
SELECT 列名 FROM 表A UNION SELECT 列名 FROM 表B;
```

**注意：**

UNION 操作符默认为选取不同的值。如果查询结果需要显示重复的值，请使用 UNION ALL。

**UNION ALL 语法：**

```sql
SELECT 列名 FROM 表A UNION ALL SELECT 列名 FROM 表B;
```

另外，UNION 结果集中的列名总是等于 UNION 中第一个 SELECT 语句中的列名。

为了实验所需，创建 Person\_b 表：

```sql
CREATE TABLE Persons_b ( Id_P int, LastName varchar(255), FirstName varchar(255), Address varchar(255), City varchar(255) ); INSERT INTO Persons_b VALUES (1, 'Bill', 'Gates', 'Xuanwumen 10', 'Londo'); INSERT INTO Persons_b VALUES (2, 'John', 'Adams', 'Oxford Street', 'nBeijing'); INSERT INTO Persons_b VALUES (3, 'George', 'Bush', 'Fifth Avenue', 'Beijing'); INSERT INTO Persons_b VALUES (4, 'Thomas', 'Carter', 'Changan Street', 'New York'); INSERT INTO Persons_b VALUES (5, 'William', 'Carter', 'Xuanwumen 10', 'Beijing'); select * from persons_b;
```

![](https://img-blog.csdnimg.cn/img_convert/d63d8ab3f3e27a079979ecbf4b1a1313.png)

**实例：**

**使用 UNION 命令：**

列出 persons 和 persons\_b 中不同的人：

```sql
select * from persons UNION select * from persons_b;
```

![](https://img-blog.csdnimg.cn/img_convert/9a8ca5284b58eb4c0f25e2074a44f1f4.png)

**注意：**

UNION 内部的 SELECT 语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每条 SELECT 语句中的列的顺序必须相同。

### **7. NOT NULL – 非空**

**NOT NULL** 约束强制列不接受 NULL 值。

NOT NULL 约束强制字段始终包含值。这意味着，如果不向字段添加值，就无法插入新记录或者更新记录。

**语法：**

```sql
CREATE TABLE 表 ( 列 int NOT NULL );
```

如上，创建一个表，设置列值不能为空。

**实例：**

```sql
create table lucifer (id number not null); insert into lucifer values (NULL);
```

![](https://img-blog.csdnimg.cn/img_convert/66c65933265be74019697105a370a802.png)

**注意：**

如果插入 **NULL** 值，则会报错 **ORA-01400** 提示无法插入！

**拓展小知识：**

**NOT NULL** 也可以用于查询条件：

```sql
select * from persons where FirstName is not null;
```

![](https://img-blog.csdnimg.cn/img_convert/44423bde10b8aa5d91a5bd2562b696c4.png)

同理，**NULL** 也可：

```sql
select * from persons where FirstName is null;
```

感兴趣的朋友，可以自己尝试一下！

### **8. VIEW – 视图**

在 SQL 中，视图是基于 SQL 语句的结果集的可视化的表。

视图包含行和列，就像一个真实的表。视图中的字段就是来自一个或多个数据库中的真实的表中的字段。我们可以向视图添加 SQL 函数、WHERE 以及 JOIN 语句，我们也可以提交数据，就像这些来自于某个单一的表。

**语\*\*\*\*法：**

```sql
CREATE VIEW 视图名 AS SELECT 列名 FROM 表名 WHERE 查询条件;
```

**注意：**

视图总是显示最近的数据。每当用户查询视图时，数据库引擎通过使用 SQL 语句来重建数据。

**实例：**

下面，我们将 Persons 表中住在 Beijing 的人筛选出来创建视图：

```sql
create view persons_beijing as select * from persons where city='Beijing';
```

![](https://img-blog.csdnimg.cn/img_convert/f0e44fe6c696a481325ddcb6503cdb3d.png)

查询上面这个视图：

![](https://img-blog.csdnimg.cn/img_convert/62638e7c7cd123f98e02ee51f412eaa3.png)

如果需要更新视图中的列或者其他信息，无需删除，使用 **CREATE OR REPLACE VIEW** 选项：

```sql
CREATE OR REPLACE VIEW 视图名 AS SELECT 列名 FROM 表名 WHERE 查询条件;
```

**实例：**

现在需要筛选出，LASTNAME 为 Gates 的记录：

```sql
create or replace view persons_beijing as select * from persons where lastname='Gates';
```

![](https://img-blog.csdnimg.cn/img_convert/fba82867ab64f97ed2984ac0e47c1dce.png)![](https://img-blog.csdnimg.cn/img_convert/4db637e34c1020aaec60e3aed0e01f8f.png)

删除视图就比较简单，跟表差不多，使用 **DROP** 即可：

```sql
drop view persons_beijing;
```

![](https://img-blog.csdnimg.cn/img_convert/d8727f4930b4e5c5f20181e5f64dc542.png)

## **04 SQL 常用函数学习**

SQL 拥有很多可用于计数和计算的内建函数。

**函数的使用语法：**

```sql
SELECT function(列) FROM 表;
```

**下面就来看看有哪些常用的函数！**

### **1. AVG – 平均值**

AVG 函数返回数值列的平均值。NULL 值不包括在计算中。

**语法：**

```sql
SELECT AVG(列名) FROM 表名;
```

**实例：**

计算 “orderno” 字段的平均值。

```sql
select avg(orderno) from orders;
```

![](https://img-blog.csdnimg.cn/img_convert/ed6bd33337f08481871ded848e06de69.png)

当然，也可以用在查询条件中，例如查询低于平均值的记录：

```sql
select * from orders where orderno < (select avg(orderno) from orders);
```

![](https://img-blog.csdnimg.cn/img_convert/2385da0567113cf697b493616183aa1e.png)

### **2. COUNT – 汇总行数**

COUNT() 函数返回匹配指定条件的行数。

**语** **法：**

**count()** 中可以有不同的语法：

-   COUNT(\*) ：返回表中的记录数。
    
-   COUNT(DISTINCT 列名) ：返回指定列的不同值的数目。
    
-   COUNT(列名) ：返回指定列的值的数目（NULL 不计入）。
    

```sql
SELECT COUNT(*) FROM 表名; SELECT COUNT(DISTINCT 列名) FROM 表名; SELECT COUNT(列名) FROM 表名;
```

**实例：**

**COUNT(*) ：**

```sql
select count(*) from persons;
```

![](https://img-blog.csdnimg.cn/img_convert/b25c976e8ea0ab8327b477142c5e0894.png)

**COUNT(DISTINCT 列名) ：**

```sql
select count(distinct city) from persons;
```

![](https://img-blog.csdnimg.cn/img_convert/4682fa7e9a313a83d6c87c29e1494ac0.png)

**COUNT(列名) ：**

```sql
select count(city) from persons;
```

![](https://img-blog.csdnimg.cn/img_convert/b5b29f2f45c49cea1d84e2bcfc8310e7.png)

### **3. MAX – 最大值**

**MAX** 函数返回一列中的最大值。NULL 值不包括在计算中。

**语法：**

```sql
SELECT MAX(列名) FROM 表名;
```

MIN 和 MAX 也可用于文本列，以获得按字母顺序排列的最高或最低值。

**实例：**

```sql
select max(orderno) from orders;
```

![](https://img-blog.csdnimg.cn/img_convert/bd228e8c30fd88b9707ff9a46347ebb5.png)

### **4. MIN – 最小值**

**MIN** 函数返回一列中的最小值。NULL 值不包括在计算中。

**语法：**

```sql
SELECT MIN(列名) FROM 表名;
```

**实例：**

```
select min(orderno) from orders;
```

![](https://img-blog.csdnimg.cn/img_convert/6b19284119e317a44422e9b43f1afeb1.png)

### **5. SUM – 求和**

**SUM** 函数返回数值列的总数（总额）。

**语法：**

```sql
SELECT SUM(列名) FROM 表名;
```

**实例：**

```sql
select sum(orderno) from orders;
```

![](https://img-blog.csdnimg.cn/img_convert/b68f73ba1e976200f837cab6b19f6a95.png)

### **6. GROUP BY – 分组**

GROUP BY 语句用于结合合计函数，根据一个或多个列对结果集进行分组。

**语法：**

```sql
SELECT 列名A, 统计函数(列名B) FROM 表名 WHERE 查询条件 GROUP BY 列名A;
```

**实例：**

获取 Persons 表中住在北京的总人数，根据 LASTNAME 分组：

```sql
select lastname,count(city) from persons where city='Beijing' group by lastname;
```

![](https://img-blog.csdnimg.cn/img_convert/fb1f47e98797417265f2cfa9f35b1fe1.png)

如果不加 **GROUP BY** 则会报错：

![](https://img-blog.csdnimg.cn/img_convert/425b78750ce5bdd2a9e88f25baca0627.png)

也就是常见的 **ORA-00937** 不是单组分组函数的错误。

### **7. HAVING – 句尾连接**

在 SQL 中增加 HAVING 子句原因是，WHERE 关键字无法与合计函数一起使用。

**语法：**

```sql
SELECT 列名A, 统计函数(列名B) FROM table_name WHERE 查询条件 GROUP BY 列名A HAVING 统计函数(列名B) 查询条件;
```

**实例：**

获取 Persons 表中住在北京的总人数大于1的 LASTNAME，根据 LASTNAME 分组：

```sql
select lastname,count(city) from persons where city='Beijing' group by lastname having count(city) > 1;
```

![](https://img-blog.csdnimg.cn/img_convert/59ec7c3fd89e0ba345584976c31425c2.png)

### **8. UCASE/UPPER – 大写**

**UCASE/UPPER** 函数把字段的值转换为大写。

**语法：**

```sql
select upper(列名) from 表名;
```

**实例：**

选取 “LastName” 和 “FirstName” 列的内容，然后把 “LastName” 列转换为大写：

```sql
select upper(lastname),firstname from persons;
```

![](https://img-blog.csdnimg.cn/img_convert/8e14a9d692413589e15b33668c2918ea.png)

### **9. LCASE/LOWER – 小写**

**LCASE/LOWER** 函数把字段的值转换为小写。

**语法：**

```sql
select lower(列名) from 表名;
```

**实例：**

选取 “LastName” 和 “FirstName” 列的内容，然后把 “LastName” 列转换为小写：

```
select lower(lastname),firstname from persons;
```

![](https://img-blog.csdnimg.cn/img_convert/46d41dba8005b16f8616c56fbff4d4b8.png)

### **10. LEN/LENGTH – 获取长度**

**LEN/LENGTH** 函数返回文本字段中值的长度。

**语法：**

```sql
select length(列名) from 表名;
```

**实例：**

获取 LASTNAME 的值字符长度：

```sql
select length(lastname),lastname from persons;
```

![](https://img-blog.csdnimg.cn/img_convert/53ca140fe99a4bf9f2295d986e4e7fc1.png)

### **11. ROUND – 数值取舍**

ROUND 函数用于把数值字段舍入为指定的小数位数。

**语法：**

```sql
select round(列名,精度) from 表名;
```

**实例：**

**保留2位：**

```sql
select round(1.1314,2) from dual; select round(1.1351,2) from dual;
```

![](https://img-blog.csdnimg.cn/img_convert/a7f16b5a0fc2ef0a057055e565d047c2.png)

![](https://img-blog.csdnimg.cn/img_convert/04e681e771a75a6927b0eac2fdc3407c.png)

**注意：** **ROUND** 取舍是 **「四舍五入」** 的！

**取整：**

```sql
select round(1.1351,0) from dual; select round(1.56,0) from dual;
```

![](https://img-blog.csdnimg.cn/img_convert/7fd29b917a61983dd4a49e81773600aa.png)

### **12. NOW/SYSDATE – 当前时间**

**NOW/SYSDATE** 函数返回当前的日期和时间。

**语法：**

```sql
select sysdate from 表名;
```

**实例：**

获取当前时间：

```sql
select sysdate from dual;
```

![](https://img-blog.csdnimg.cn/img_convert/f942b19db8a76cec10df806b9125330d.png)
